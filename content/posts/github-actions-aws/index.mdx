---
title: "Automating Deployment with GitHub Actions and AWS"
date: "2025-07-07"
slug: "/github-actions-aws-automation"
tags: ["CI/CD", "GitHub Actions", "AWS", "Automation"]
description: "A breakdown of the GitHub Actions workflows I use to test, build, and ship applications to AWS with minimal manual intervention."
theme: "Cloud & DevOps"
---

## TL;DR

- **Standardise pipelines to sleep better.** GitHub Actions replaces late-night manual deploys with predictable automation.  
- **One workflow covers multiple targets.** Static sites, APIs, and containers share the same lint → test → build → deploy flow.  
- **OIDC removes long-lived AWS keys.** Actions assume roles securely instead of storing secrets in GitHub [^oidc].  
- **Observability and rollback steps make deploys reversible.** Smoke tests, tagging, and alerts close the loop.

## Baseline CI/CD Workflow

**Workflow core:**

```yaml
name: CI/CD

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-test-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
      - run: npm ci
      - run: npm test
      - run: npm run lint
      - run: npm run build
      - name: Sync front-end to S3
        if: github.ref == 'refs/heads/main'
        uses: jakejarvis/s3-sync-action@master
        with:
          args: --acl public-read --delete
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_S3_BUCKET: ${{ secrets.AWS_S3_BUCKET }}
          AWS_REGION: us-east-1
      - name: Invalidate CloudFront cache
        if: github.ref == 'refs/heads/main'
        uses: chetan/invalidate-cloudfront-action@v2
        env:
          DISTRIBUTION: ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }}
          PATHS: "/*"
          AWS_REGION: us-east-1
```

- Immutable installs via `npm ci`, enforced test gates, and CloudFront invalidations keep releases safe and fresh.

## Secrets & Environments

- **GitHub Environments:** Stage, staging, and production approvals with scoped secrets protect against misdeploys.  
- **OIDC federation:** Replace IAM access keys with short-lived role assumption using GitHub’s identity provider [^oidc].  
- **AWS Parameter Store / Secrets Manager:** Fetch sensitive values at runtime instead of embedding them in GitHub secrets.

## Deploying Different Targets

- **Serverless (SAM/Serverless Framework):** Run `sam build` + `sam deploy --no-confirm-changeset` with promotion gates per environment.  
- **Containers (ECS/EKS):** Build + scan Docker images, push to ECR, and roll services via `aws ecs update-service` or `kubectl rollout`.  
- **Static sites:** Sync artefacts to S3, invalidate CloudFront, and log the distribution ID for traceability.

## Observability & Rollbacks

- **Smoke tests:** Post-deploy checks hit `/healthz` and scripted user flows; failures trigger rollback jobs.  
- **ChatOps:** Webhooks post status updates in Slack so everyone sees deploy progress.  
- **Version tagging:** Auto-tag releases (`vYYYY.MM.DD.N`) to correlate logs and dashboards.

## Governance & Cost Control

- **Branch protections:** Required checks and approvals prevent bypassing the pipeline.  
- **Cost dashboards:** Monitor S3, Lambda, and bandwidth after releases; flag anomalies quickly.  
- **Drift detection:** Nightly `terraform plan` / `cdk diff` runs reveal manual infra changes.

## Lessons Learned

1. **Compose modular jobs.** Reusable lint/test/deploy actions bootstrap new repos fast.  
2. **Fail early.** Validate formatting, dependencies, and secrets before the expensive deploy steps.  
3. **Document prerequisites.** Each workflow ships with a README describing secrets, IAM roles, and recovery playbooks.

## Key Takeaways

- **Automation reduces toil, not responsibility.** Pipelines make releases repeatable so engineers can focus on building.  
- **Security posture matters.** Least-privilege roles and OIDC ensure CI runs stay locked down.  
- **Always close the loop.** Observability, alerts, and tags prove the deploy worked and tell you when it doesn’t.

[^oidc]: GitHub Docs, “Configuring OpenID Connect in GitHub Actions,” accessed May 2025, https://docs.github.com/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-github-actions.
